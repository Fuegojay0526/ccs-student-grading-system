USE mvc_framework;
  DROP PROCEDURE IF EXISTS ApiKey_Update;
    
CREATE PROCEDURE ApiKey_Update(IN _Record_ID BIGINT,  IN _ApiKeyInfo LONGTEXT, IN _ApiKeyCode LONGTEXT, IN _Timestamp TIMESTAMP)
 BEGIN
   ALTER TABLE Api_Key AUTO_INCREMENT = 0;
	 ALTER TABLE Api_Key AUTO_INCREMENT = 1;
	 
   IF EXISTS(Select * From Api_Key) THEN 
    BEGIN 
	  IF(_Record_ID >=1000) THEN
	       BEGIN
            INSERT INTO Api_Key(Record_ID, API_Key_Info, API_Key_Code, Time_Stamp) 
                     Values(_Record_ID,  _ApiKeyInfo, _ApiKeyCode, _Timestamp) ON DUPLICATE KEY UPDATE  
                           API_Key_Info=VALUES(API_Key_Info),  API_Key_Code=VALUES(API_Key_Code), Time_Stamp=VALUES(Time_Stamp); 
         END;
     ELSE
	       BEGIN 
            INSERT INTO Api_Key(Record_ID, API_Key_Info, API_Key_Code, Time_Stamp)
                              Values(0, _ApiKeyInfo, _ApiKeyCode, _Timestamp);
          END;  
     END IF;		
    END; 
   ELSE
       BEGIN 
        INSERT INTO Api_Key(Record_ID, API_Key_Info, API_Key_Code, Time_Stamp) 
                    Values(1000,  _ApiKeyInfo, _ApiKeyCode, _Timestamp);
       END;  
  END IF;
     SELECT Record_ID, API_Key_Code FROM Api_Key ORDER BY Record_ID DESC LIMIT 1;
  END 